!function(){"use strict";var t={378:function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.dsxAlgorithm=void 0;var s=e(511);function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}var n=function(t){t=t||{},this.datas=t.datas,this.lastClose=t.lastClose||0,this.day=0};i.dsxAlgorithm=n,n.prototype.get=function(t,i,e,s){return this.day=i,this.datas=e,this.lastClose=s,this.evil(t)},n.prototype.evil=function(t){return new Function("_this","return _this."+t+"()")(this)},n.prototype.getObjcetProperty=function(t,i){var e=null;return i.split(".").forEach((function(i){e=null==e?t[i]:e[i]})),e},n.prototype.setObjcetProperty=function(t,i,e){var s=null,n=i.split("."),o="";n.forEach((function(i){null==s?s=t[i]:"object"==h(s[i])&&(s=s[i]),o=i})),s[o]=e},n.prototype.SUM=function(t,i){if(this.day>=i-1&&0!=i){for(var e=0,s=Math.max(0,this.day-(i-1));s<=this.day;s++){var h=this.datas[s],n=t,o="",a=0;if(t.indexOf("-")>0){var r=t.split("-");n=r[0],o=r[1],a=h[n]-h[o]}else if(t.indexOf("+")>0){var d=t.split("+");n=d[0],o=d[1],a=h[n]+h[o]}else a=h[n];a&&(e+=parseFloat(a))}return e}return 0},n.prototype.VOL=function(){var t=this,i=s.dsxConfig.index.VOL,e=this.datas[this.day];null==e.ZHIBIAO.VOL&&(e.ZHIBIAO.VOL={});var h=i.value;return Object.keys(h).forEach((function(i){var s=h[i];0==s&&(e.ZHIBIAO.VOL[i]=e.VOL),0!=s&&(e.ZHIBIAO.VOL[i]=t.GMA("VOL",s))})),e},n.prototype.MA=function(){var t=this,i=this.datas[this.day];null==i.ZHIBIAO.MA&&(i.ZHIBIAO.MA={});var e=s.dsxConfig.index.MA.value;return Object.keys(e).forEach((function(s){var h=e[s];i.ZHIBIAO.MA[s]=t.GMA("CLOSE",h)})),i},n.prototype.TMA=function(){var t=this.datas[this.day];null==t.ZHIBIAO.TMA&&(t.ZHIBIAO.TMA={});var i=t.CLOSE;"string"==typeof i&&(i=parseFloat(i));var e=i;if(t.TIMEINDEX>=0){var s=this.datas[this.day>0?this.day-1:this.day];null==s.ZHIBIAO.TMA&&(s.ZHIBIAO.TMA={});var h=s.ZHIBIAO.TMA.lastAllClose?s.ZHIBIAO.TMA.lastAllClose:0;parseInt(t.TIME)<parseInt(s.TIME)&&this.day>0&&(h=0),e+=h}t.ZHIBIAO.TMA.lastAllClose=e,e/=t.TIMEINDEX+1,t.ZHIBIAO.TMA["均价"]=e;var n=this.lastClose>0?i-this.lastClose:0,o=this.lastClose>0?n/this.lastClose*100:0;return t.ZHIBIAO.TMA["新值"]=i.toFixed(2)+" "+n.toFixed(2)+" "+o.toFixed(2)+"%",t.ZHIBIAO.TMA["新值.value"]=i,t},n.prototype.MACD=function(){var t=this.datas[this.day];null==t.ZHIBIAO.MACD&&(t.ZHIBIAO.MACD={});var i=this.EMA("CLOSE",12)-this.EMA("CLOSE",26);t.ZHIBIAO.MACD.DIFF=i;var e=0;this.day>0&&(e=this.datas[this.day-1].ZHIBIAO.MACD.DEA);var s=8*e/10+2*i/10;t.ZHIBIAO.MACD.DEA=s;var h=2*(i-s);return t.ZHIBIAO.MACD.MACD=h,t},n.prototype.KDJ=function(){var t=this.datas[this.day];null==t.ZHIBIAO.KDJ&&(t.ZHIBIAO.KDJ={});var i=null;this.day>0&&(i=this.datas[this.day-1]);var e=this.MIN("LOW",9),s=this.MAX("HIGH",9),h=s==e?0:(t.CLOSE-e)/(s-e)*100,n=null!=i?i.ZHIBIAO.KDJ.K:0,o=2/3*(n=n||0)+1/3*h,a=null!=i?i.ZHIBIAO.KDJ.D:0,r=2/3*(a=a||0)+1/3*o,d=3*o-2*r;return t.ZHIBIAO.KDJ.K=o,t.ZHIBIAO.KDJ.D=r,t.ZHIBIAO.KDJ.J=d,t},n.prototype.BOLL=function(){var t=this.datas[this.day];null==t.ZHIBIAO.BOLL&&(t.ZHIBIAO.BOLL={});for(var i=s.dsxConfig.index.BOLL.value.N,e=s.dsxConfig.index.BOLL.value.M,h=this.GMA("CLOSE",i),n=0,o=Math.max(0,this.day-(i-1));o<=this.day;o++){var a=this.datas[o],r=parseFloat(a.CLOSE),d=this.datas[o].ZHIBIAO.BOLL.MA20;r&&d&&(n+=(r-d)*(r-d))}var l=parseFloat(Math.sqrt(n/i));return t.ZHIBIAO.BOLL.MA20=h,t.ZHIBIAO.BOLL.MD=parseFloat(l),t.ZHIBIAO.BOLL.MID=parseFloat(h),t.ZHIBIAO.BOLL.UP=parseFloat(h+e*l),t.ZHIBIAO.BOLL.LOW=parseFloat(h-e*l),t},n.prototype.RSI=function(){var t=this.datas[this.day];null==t.ZHIBIAO.RSI&&(t.ZHIBIAO.RSI={});var i=s.dsxConfig.index.RSI.value.RSI6,e=s.dsxConfig.index.RSI.value.RSI12,h=s.dsxConfig.index.RSI.value.RSI24,n=this.datas[Math.max(this.day-1,0)].CLOSE,o=t.CLOSE,a=Math.max(o-n,0),r=Math.abs(o-n);t.ZHIBIAO.RSI.A=a,t.ZHIBIAO.RSI.B=r;var d=this.SMA("ZHIBIAO.RSI.A",i,1),l=this.SMA("ZHIBIAO.RSI.A",e,1),c=this.SMA("ZHIBIAO.RSI.A",h,1),p=this.SMA("ZHIBIAO.RSI.B",i,1),g=this.SMA("ZHIBIAO.RSI.B",e,1),f=this.SMA("ZHIBIAO.RSI.B",h,1),u=0==p?0:d/p*100,m=0==g?0:l/g*100,T=0==f?0:c/f*100;return t.ZHIBIAO.RSI.RSI6=u,t.ZHIBIAO.RSI.RSI12=m,t.ZHIBIAO.RSI.RSI24=T,t},n.prototype.MIN=function(t,i){for(var e=1e7,s=e,h=Math.max(0,this.day-(i-1));h<=this.day;h++){var n=this.datas[h],o=parseFloat(n[t]);o&&(s=Math.min(s,o))}return s==e&&(s=0),s},n.prototype.LLV=function(t){return this.MIN("LOW",t)},n.prototype.MAX=function(t,i){for(var e=-1e7,s=e,h=Math.max(0,this.day-(i-1));h<=this.day;h++){var n=this.datas[h],o=parseFloat(n[t]);o&&(s=Math.max(s,o))}return s==e&&(s=0),s},n.prototype.HHV=function(t){return this.MAX("HIGH",t)},n.prototype.UPDAYS=function(t){for(var i=0,e=Math.max(0,this.day-(t-1));e<=this.day;e++){var s=this.datas[e];s.CLOSE>s.LASTCLOSE&&i++}return i},n.prototype.DOWNDAYS=function(t){for(var i=0,e=Math.max(0,this.day-(t-1));e<=this.day;e++){var s=this.datas[e];s.CLOSE<s.LASTCLOSE&&i++}return i},n.prototype.GMA=function(t,i){if(this.day>=i-1&&0!=i){for(var e=0,s=Math.max(0,this.day-(i-1));s<=this.day;s++){var h=this.datas[s],n=this.getObjcetProperty(h,t);n&&(e+=parseFloat(n))}return parseFloat(e/i)}return null},n.prototype.EMA=function(t,i){var e=this.datas[this.day],s=(i-1)/(i+1),h=this.getObjcetProperty(e,t);return this.day>0&&(h=this.datas[this.day-1]["EMA"+i]*s+h*(1-s)),e["EMA"+i]=h,h},n.prototype.SMA=function(t,i,e){var s=this.datas[this.day],h=this.getObjcetProperty(s,t),n=0;if(this.day>0){var o=this.datas[this.day-1];n=(e*h+(i-e)*this.getObjcetProperty(o,t+"_SMA_"+i))/i}return this.setObjcetProperty(s,t+"_SMA_"+i,n),n},n.prototype.WR=function(){var t=this,i=this.datas[this.day];null==i.ZHIBIAO.WR&&(i.ZHIBIAO.WR={});var e=s.dsxConfig.index.WR,h=i.CLOSE,n=e.value;return Object.keys(n).forEach((function(e){var s=n[e];i.ZHIBIAO.WR[e]=t._WR(s,h)})),i},n.prototype._WR=function(t,i){var e=this.HHV(t),s=this.LLV(t),h=(e-i)/(e-s)*100;return e-s==0&&(h=0),h},n.prototype.BIAS=function(){var t=this,i=this.datas[this.day];null==i.ZHIBIAO.BIAS&&(i.ZHIBIAO.BIAS={});var e=s.dsxConfig.index.BIAS,h=i.CLOSE,n=e.value;return Object.keys(n).forEach((function(e){var s=n[e];i.ZHIBIAO.BIAS[e]=t._BIAS(h,s)})),i},n.prototype._BIAS=function(t,i){var e=this.GMA("CLOSE",i);return(t-e)/e*100},n.prototype.CCI=function(){var t=this,i=this.datas[this.day];null==i.ZHIBIAO.CCI&&(i.ZHIBIAO.CCI={});var e=s.dsxConfig.index.CCI.value;return Object.keys(e).forEach((function(s){var h=e[s];i.ZHIBIAO.CCI[s]=t._CCI(i,h)})),i},n.prototype._CCI=function(t,i){var e=(t.HIGH+t.LOW+t.CLOSE)/3;t.ZHIBIAO.CCI.TYP=e;var s=this.GMA("ZHIBIAO.CCI.TYP",i);return t.ZHIBIAO.CCI.MATYP=s,(e-s)/(.015*this._AVEDEV(s,i))},n.prototype._CCIMD=function(t,i){if(this.day>=i-1&&0!=i){for(var e=0,s=Math.max(0,this.day-(i-1));s<=this.day;s++){var h=this.datas[s].CLOSE,n=Math.abs(t-h);e+=parseFloat(n)}return parseFloat(e/i)}return null},n.prototype._AVEDEV=function(t,i){if(this.day>=i-1&&0!=i){for(var e=0,s=Math.max(0,this.day-(i-1));s<=this.day;s++){var h=this.datas[s].ZHIBIAO.CCI.TYP,n=Math.abs(h-t);e+=parseFloat(n)}return parseFloat(e/i)}return null},n.prototype.PSY=function(){var t=this,i=this.datas[this.day];null==i.ZHIBIAO.PSY&&(i.ZHIBIAO.PSY={});var e=s.dsxConfig.index.PSY.value;return Object.keys(e).forEach((function(s){var h=e[s];i.ZHIBIAO.PSY[s]=t._PSY(i,s,h)})),i},n.prototype._PSY=function(t,i,e){return"PSY"==i?this.UPDAYS(e)/e*100:"PSYMA"==i?this.GMA("ZHIBIAO.PSY.PSY",e):void 0},e.g.dsxAlgorithm=n},439:function(t,i){function e(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}Object.defineProperty(i,"__esModule",{value:!0}),i.Bezier=void 0;var s=function(){function t(i,e,s,h){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.px3=3*i,this.px2=3*(s-i)-this.px3,this.px1=1-this.px3-this.px2,this.py3=3*e,this.py2=3*(h-e)-this.py3,this.py1=1-this.py3-this.py2,this.epsilon=1e-7}var i,s;return i=t,(s=[{key:"getX",value:function(t){return((this.px1*t+this.px2)*t+this.px3)*t}},{key:"getY",value:function(t){return((this.py1*t+this.py2)*t+this.py3)*t}},{key:"solve",value:function(t){if(0===t||1===t)return this.getY(t);for(var i=t,e=0;e<8;e++){var s=this.getX(i)-t;if(Math.abs(s)<this.epsilon)return this.getY(i);var h=(3*this.px1*i+2*this.px2)*i+this.px3;if(Math.abs(h)<1e-6)break;i-=s/h}return this.getY(i)}}])&&e(i.prototype,s),Object.defineProperty(i,"prototype",{writable:!1}),t}();i.Bezier=s},511:function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.dsxConfig=void 0;var s={};i.dsxConfig=s,s.chartType={timeSharing:0,timeSharing5:1,candle:2},s.candleType={hollow:0,solid:1},s.zoomLockType={left:1,middle:2,right:3,follow:4},s.market={sh:"9:30-11:30,13:00-15:00",sz:"9:30-11:30,13:00-15:00",bj:"9:30-11:30,13:00-15:00",hk:"9:30-12:00,13:00-16:00",us:"9:30-12:00,12:00-16:00",fu:"9:30-12:00,12:00-16:00",sp:"9:30-12:00,12:00-16:00",wh:"9:30-12:00,12:00-16:00"},s.entity={candle:["DATE","OPEN","HIGH","LOW","CLOSE","VOL","AMOUNT","TIME"],timeSharing:["DATE","TIME","CLOSE","VOL","AMOUNT"]},s.index={VOL:{title:"成交量",value:{VOL:0,MA5:5,MA10:10},draw:{VOL:{model:"column",color:"CLOSE",hiddenTitle:!0},MA5:{model:"line",color:"#FFA500"},MA10:{model:"line",color:"#87CEFA"}},chartType:[s.chartType.timeSharing,s.chartType.timeSharing5,s.chartType.candle],location:["sides"]},TMA:{title:"",value:{"均价":1},draw:{"均价":{model:"line",color:"#FFA500"},"新值":{model:"text",color:"",colorValue:0}},chartType:[s.chartType.timeSharing,s.chartType.timeSharing5],location:["main"]},MA:{title:"均线",value:{MA5:5,MA10:10,MA30:30,MA60:60},draw:{MA5:{model:"line",color:"#FFA500"},MA10:{model:"line",color:"#87CEFA"},MA30:{model:"line",color:"#BA55D3"},MA60:{model:"line",color:"#808000"}},chartType:[s.chartType.timeSharing,s.chartType.timeSharing5,s.chartType.candle],location:["main"]},MACD:{title:"MACD(26,9,12)",value:{DIFF:0,DEA:0,MACD:0,long:26,d:9,short:12},draw:{DIFF:{model:"line",color:"#FFA500"},DEA:{model:"line",color:"#87CEFA"},MACD:{model:"column",color:"#BA55D3"}},chartType:[s.chartType.timeSharing,s.chartType.timeSharing5,s.chartType.candle],location:["sides"]},KDJ:{title:"KDJ(9,3,3)",value:{K:9,D:3,J:3},draw:{K:{model:"line",color:"#FFA500"},D:{model:"line",color:"#87CEFA"},J:{model:"line",color:"#BA55D3"}},chartType:[s.chartType.candle],location:["sides"]},BOLL:{title:"BOLL(20,2)",value:{UP:0,MID:0,LOW:0,N:20,M:2},draw:{UP:{model:"line",color:"#FFA500"},MID:{model:"line",color:"#87CEFA"},LOW:{model:"line",color:"#BA55D3"}},chartType:[s.chartType.candle],location:["main"]},RSI:{title:"RSI(6,12,24)",value:{RSI6:6,RSI12:12,RSI24:24},draw:{RSI6:{model:"line",color:"#FFA500"},RSI12:{model:"line",color:"#87CEFA"},RSI24:{model:"line",color:"#BA55D3"}},chartType:[s.chartType.timeSharing,s.chartType.timeSharing5,s.chartType.candle],location:["sides"]},WR:{title:"WR(6,10)",value:{WR6:6,WR10:10},draw:{WR6:{model:"line",color:"#FFA500"},WR10:{model:"line",color:"#87CEFA"}},chartType:[s.chartType.candle],location:["sides"]},BIAS:{title:"BIAS(6,12,24)",value:{BIAS6:6,BIAS12:12,BIAS24:24},draw:{BIAS6:{model:"line",color:"#FFA500"},BIAS12:{model:"line",color:"#87CEFA"},BIAS24:{model:"line",color:"#BA55D3"}},chartType:[s.chartType.candle],location:["sides"]},CCI:{title:"CCI(14)",value:{CCI14:14},draw:{CCI14:{model:"line",color:"#FFA500"}},chartType:[s.chartType.candle],location:["sides"]},PSY:{title:"PSY(12,6)",value:{PSY:12,PSYMA:6},draw:{PSY:{model:"line",color:"#FFA500"},PSYMA:{model:"line",color:"#87CEFA"}},chartType:[s.chartType.candle],location:["sides"]}},s.theme={white:{backgroundColor:"#ffffff",color:"#333333",fontSize:window.devicePixelRatio<=1?12:10,redColor:"#F44336",greenColor:"#4CAF50",crossLineColor:"#2196F3",crossLineWidth:1,fontBgColor:"#2196F3",gridLineColor:"#eeeeee",gridLineCount:3,gridLineWidth:1,lineWidth:1,klineWidth:10,klinePadding:1,timeSharingLineColor:"#2196F3",timeSharingLineFillColor:"rgba(65,105,225,0.1)"},dark:{backgroundColor:"rgba(19, 23, 34, 1)",color:"#c5cbce",fontSize:window.devicePixelRatio<=1?12:10,redColor:"#F44336",greenColor:"#4CAF50",crossLineColor:"#2196F3",crossLineWidth:1,fontBgColor:"#2196F3",gridLineColor:"#191b28",gridLineCount:3,gridLineWidth:1,lineWidth:1,klineWidth:10,klinePadding:1,timeSharingLineColor:"#2196F3",timeSharingLineFillColor:"rgba(65,105,225,0.1)"}},e.g.dsxConfig=s},545:function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.mouseEvent=void 0;var s=e(511),h=e(439);i.mouseEvent=function(){var t,i,e=0,n=null,o=0,a=null,r=this.zoomstep*this.dpr,d=0,l=0,c=null,p=!1,g=null,f=this,u=0,m=this.canvas2,T=new h.Bezier(.17,.89,.45,1),x=0;if(document.attachEvent&&m.attachEvent("onmousewheel",A),document.addEventListener){m.addEventListener("gesturestart",(function(t){return t.preventDefault(),!1}),!1),m.addEventListener("mouseout",(function(){f.fingers=0,f.isMouseDown=!1,clearTimeout(a)}),!1),m.addEventListener("mouseleave",(function(){f.fingers=0,f.isMouseDown=!1,clearTimeout(a)}),!1);var y="ontouchstart"in document.documentElement?"touchstart":"mousedown";m.addEventListener(y,(function(h){if(1==f.isStartLoading&&f.chartType>=s.dsxConfig.chartType.candle)f.showDebug("touch loading data ...");else if(1==f.lockui&&f.chartType>=s.dsxConfig.chartType.candle)f.showDebug("touch ui stop ...");else{if(function(t){p&&f.crossHidden(),f.touchstart&&f.touchstart(),f.fingers<=0&&(f.fingers=0),f.fingers++,f.isMouseDown=!0,e=(new Date).getTime(),clearTimeout(a),clearTimeout(g),M(!0),f.scrollX=0,c=null,p=!1,f.crossing=!1,f.isscrolling=!1,l=t.mx,f.fingers=Math.max(f.fingers,null!=I(t)?I(t).length:0)}(h=C(h)),h.target,f.element,t=h.mx,i=h.my,u=h.my,null==I(h))m.addEventListener("mousemove",w,!1),m.addEventListener("mouseup",v,!1);else if(m.addEventListener("touchmove",w,!1),m.addEventListener("touchend",v,!1),f.fingers>1)return d=b(h),S();f.mobileCross||(a=setTimeout((function(){!function(e){t=e.mx,i=e.my,f.fingers>1||(E(t,i),S(e),clearTimeout(g)),clearTimeout(a)}(h)}),500))}}),!1),m.addEventListener("DOMMouseScroll",A,!1)}function I(t){return t.changedTouches&&t.changedTouches[0]?t.changedTouches:t.targetTouches&&t.targetTouches[0]?t.targetTouches:t.touches&&t.touches[0]?t.touches:t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]?t.originalEvent.changedTouches:null}function S(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.preventDefault(),!1}function C(t){t||((t=window.event).target=t.srcElement,t.layerX=t.offsetX,t.layerY=t.offsetY);var i=null,e=null,s=I(t);return s&&(i=s[0].pageX,e=s[0].pageY),t.mx=(t.pageX||i)-f.element.offsetLeft,t.my=(t.pageY||e)-f.element.offsetTop,t}function w(e){if(clearTimeout(a),1==f.isStartLoading&&f.chartType>=s.dsxConfig.chartType.candle)f.showDebug("move loading data ...");else{if(!(1==f.lockui&&f.chartType>=s.dsxConfig.chartType.candle)){if(f.touchmove&&f.touchmove(),1==f.isStartLoading)return!0;if(e=C(e),f.fingers=Math.max(f.fingers,null!=I(e)?I(e).length:0),f.fingers>1&&f.chartType==s.dsxConfig.chartType.candle){f.crossing=!1,f.isscrolling=!1;var h=b(e);if(0==h)return;return c=_(e.mx+h/2),f._getMiddleKlineLineIndex(c),(h=Math.abs(h))>(d=Math.abs(d))&&D(r,c),h<d&&D(-r,c),d=h,!0}if(c=null,clearTimeout(g),x=function(t,i,e,s){var h=e-t,n=s-i,o=0;if(Math.abs(h)<2&&Math.abs(n)<2)return o;var a=function(t,i){return 180*Math.atan2(i,t)/Math.PI}(h,n);return a>=-135&&a<=-45?o=1:a>45&&a<135?o=2:a>=135&&a<=180||a>=-180&&a<-135?o=3:a>=-45&&a<=45&&(o=4),o}(t,i,e.mx,e.my),0==p&&(1==x||2==x)){var n=e.my-u;return u=e.my,f.isscrolling=!1,f.crossing=!1,o=0,f.moveUpOrDown&&f.moveUpOrDown(x+","+n),!0}u=e.my;var l=e.mx-t;return 0==o&&O(l),1==o&&p&&!f.mobileCross&&E(e.mx,e.my),S(e)}f.showDebug("move ui stop ...")}}function v(i){if(f.fingers=0,m.removeEventListener("touchmove",w,!1),m.removeEventListener("touchend",v,!1),m.removeEventListener("mousemove",w,!1),m.removeEventListener("mouseup",v,!1),clearTimeout(a),clearTimeout(g),M(!0),1==f.isStartLoading&&f.chartType>=s.dsxConfig.chartType.candle)f.showDebug("stop loading data ...");else if(1==f.lockui&&f.chartType>=s.dsxConfig.chartType.candle)f.showDebug("stop ui stop ...");else if(f.zooming=!1,o=0,f.crossing=!1,e=(new Date).getTime()-e,i=C(i),t=i.mx,l=i.mx-l,0==p)if(f.isMouseDown&&e<=300&&e>1){if(f.chartType==s.dsxConfig.chartType.timeSharing)return;!function(){var t=("ontouchstart"in document.documentElement?3:2)*l/(.003*e)*f.dpr;if(!(M(!0),clearTimeout(a),f.isMouseDown=!1,null==t||null==t||x<=2||0==t)){var i=performance.now(),s=0,h=function e(h){var o=(h-i)/3e3;if(o>=1)return o=1,void M(!0);if(n=window.requestAnimationFrame(e),!(o<0)){var a=parseInt(T.solve(o)*t);a!=s&&(f.isMouseDown||f.isScrollRightEnd||f.isScrollLeftStart||f.startIndex<=0?M(!0):(O(a),s=a))}};i=performance.now(),setTimeout((function(){n=window.requestAnimationFrame(h)}),10)}}()}else f.isscrolling=!1,f.crossing=!1,f.isStartLoading=!1,f.currentIndex=f.showDatas.length-1,f.currentData=f.showDatas[f.currentIndex],f.lastIndex=f.startIndex,f.touchend&&f.touchend();else{if(!f.mobileCross)return void(g=setTimeout((function(){f.isscrolling=!1,f.crossing=!1,f.crossIsFinished=!0,f.isStartLoading=!1,f.currentIndex=f.showDatas.length-1,f.currentData=f.showDatas[f.currentIndex],f._update(),f.lastIndex=f.startIndex,f.touchend&&f.touchend()}),3e3));0==f.startIndex&&(f.isScrollLeftStart=!0,f._scrollLeftLoadMoreData())}}m.onmousewheel=A;var L=null;function M(t){(t||f.isMouseDown||f.isScrollRightEnd||f.isScrollLeftStart||f.startIndex<=0)&&(window.cancelAnimationFrame(n),f.lastIndex=f.startIndex,f.isscrolling=!1,0==f.startIndex&&0==f.isStartLoading&&n!=L&&(f.isScrollLeftStart=!0,f._scrollLeftLoadMoreData()),f.touchend&&f.touchend(),L=n)}function A(t){return t=C(t),f.chartType<=s.dsxConfig.chartType.timeSharing5||t.target!=f.element&&t.target!=f.canvas1&&t.target!=f.canvas2?S():0!=(c=_(t.mx))?(f._getMiddleKlineLineIndex(c),t.wheelDelta?(t.wheelDelta>0&&D(r,c),t.wheelDelta<0&&D(-r,c)):t.detail&&(t.detail>0&&D(-r,c),t.detail<0&&D(r,c)),S(t)):void 0}function O(t){0!=t&&f.scroll(t)}function E(t,i){p=!0,f.zooming=!1,o=1,f.cross(t,i)}function _(t){if(null!=c&&f.zoomLockType!=s.dsxConfig.zoomLockType.follow)return c;var i=t*f.dpr;return f.zoomLockType==s.dsxConfig.zoomLockType.left?.001:f.zoomLockType==s.dsxConfig.zoomLockType.middle?f.width/2:f.zoomLockType==s.dsxConfig.zoomLockType.right?f.width:f.zoomLockType==s.dsxConfig.zoomLockType.follow?i:void 0}function D(t,i){f.mobileZoom||f.zoom(t,i)}function b(t){if(null==I(t))return 0;if(I(t).length<=1)return 0;var i=t.targetTouches[0].pageX,e=(t.targetTouches[0].pageY,t.targetTouches[1].pageX);return t.targetTouches[1].pageY,e-i}}}},i={};function e(s){var h=i[s];if(void 0!==h)return h.exports;var n=i[s]={exports:{}};return t[s](n,n.exports,e),n.exports}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(){var t=e(511),i=e(378),s=e(545);function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}var n=function(e){e=e||{},this.theme=t.dsxConfig.theme[e.theme||"white"]||t.dsxConfig.theme.white,this.chartType=null!=e.chartType?e.chartType:t.dsxConfig.chartType.candle,this.lastChartType,this.market=e.market||t.dsxConfig.market.sh,this.candleType=null!=e.candleType?e.candleType:t.dsxConfig.candleType.hollow,this.dpr=e.dpr?e.dpr:window.devicePixelRatio?window.devicePixelRatio:2,this.element=e.element,this.canvas1,this.canvas2,this.width=e.width?e.width:e.element.width,this.height=e.height?e.height:e.element.height,this.paddingTop=(e.paddingTop?e.paddingTop:20)*this.dpr,this.paddingMiddle=(e.paddingMiddle?e.paddingMiddle:20)*this.dpr,this.paddingBottom=(e.paddingBottom?e.paddingBottom:1)*this.dpr,this.autoSize=e.autoSize||!1,this.context,this.context2,this.datas=e.datas,this.rawDatas=e.datas,this.showDatas=[],this.currentData=[],this.highIndex=-1,this.lowIndex=-1,this.maxY=0,this.minY=1e9,this.lastClose=e.lastClose,this.scrollX=0,this.lastScrollX=0,this.isscrolling=!1,this.startX=0,this.isScrollRightEnd=!1,this.isScrollLeftStart=!1,this.currentIndex=0,this.lastIndex=null,this.startIndex=0,this.scrollAmount=0,this.crossing=!1,this.crossIsFinished=!1,this.mobileCross=null!=e.mobileCross&&e.mobileCross,this.onCrossing=e.onCrossing,this.zooming=!1,this.zoomstep=e.zoomstep||.5,this.zoomMin=(e.zoomMin||3)*this.dpr,this.zoomMax=(e.zoomMax||50)*this.dpr,this.zoomx=0,this.zoomindex=0,this.zoomLockType=e.zoomLockType||t.dsxConfig.zoomLockType.middle,this.mobileZoom=null!=e.mobileZoom&&e.mobileZoom,this.sides=e.sides||["VOL"],this.main=this.chartType<=t.dsxConfig.chartType.timeSharing5?["TMA"]:e.main||["MA"],this.sideHeight=e.sideHeight?e.sideHeight*this.dpr:null,this.mainHeight=this.height-this.sideHeight*this.sides.length-this.paddingTop-this.paddingBottom-this.paddingMiddle,this.indexMaxMin={},this.showTipCallback=e.showTipCallback,this.debug=e.debug||!1,this.showLog=e.showLog||!1,this.loadingText=e.loadingText||"正在加载...",this.scrollLeftCallBack=e.scrollLeftCallBack,this.nextPage=e.nextPage,this.rightEmptyKlineAmount=null==e.rightEmptyKlineAmount?3:e.rightEmptyKlineAmount,this.onLoading=e.onLoading||function(){},this.updateComplate=e.updateComplate||function(){},this.isMouseDown=!1,this.isStartLoading=!1,this.fingers=0,this.showDateKlines=[],this.totalPoints=0,this.timePeriod=e.timePeriod,this.times=e.times||[],this.times5=[],this.isShowKlineTipPannel=null==e.isShowKlineTipPannel||e.isShowKlineTipPannel,this.touchend=e.touchend,this.touchstart=e.touchstart,this.touchmove=e.touchmove,this.moveUpOrDown=e.moveUpOrDown,this.page=e.page||1,this.theend=null!=e.theend&&e.theend,this.dsxLittleCycleTImer,this.timeLineTotalModel=null==e.timeLineTotalModel||e.timeLineTotalModel,this.decimalPoint=e.decimalPoint||2,this.lockui=!1,this.indexPlug=new i.dsxAlgorithm({lastClose:this.lastClose}),this._init()};n.prototype.log=function(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];this.showLog&&console.log(i)},n.prototype._updateTheme=function(i){i&&(this.theme=t.dsxConfig.theme[i||"white"]||t.dsxConfig.theme.white),this.backgroundColor=this.theme.backgroundColor,this.backgroundImage=this.theme.backgroundImage,this.klineWidth=this.klineWidth?this.klineWidth:(this.theme.klineWidth||10)*this.dpr,this.klinePadding=(this.theme.klinePadding||1)*this.dpr,this.gridLineWidth=(this.theme.gridLineWidth||1)*this.dpr,this.gridLineCount=this.theme.gridLineCount||3,this.gridLineColor=this.theme.gridLineColor||t.dsxConfig.theme.white.gridLineColor,this.lineWidth=(this.theme.lineWidth||1)*this.dpr,this.timeSharingLineColor=this.theme.timeSharingLineColor||this.theme.gridLineColor,this.timeSharingLineFillColor=this.theme.timeSharingLineFillColor,this.red=this.theme.redColor||t.dsxConfig.theme.white.redColor,this.green=this.theme.greenColor||t.dsxConfig.theme.white.greenColor,this.crossLineWidth=(this.theme.crossLineWidth||1)*this.dpr,this.crossLineColor=this.theme.crossLineColor||t.dsxConfig.theme.white.crossLineColor,this.fontSize=(this.theme.fontSize||12)*this.dpr,this.fontColor=this.theme.color||t.dsxConfig.theme.white.color,this.fontBgColor=this.theme.fontBgColor||t.dsxConfig.theme.white.fontBgColor,this._setTimePoints()},n.prototype.set=function(i){i.theme&&this._updateTheme(i.theme),i.element&&(this.element=i.element),i.width&&(this.width=i.width),i.height&&(this.height=i.height),i.context&&(this.context=i.element.getContext("2d")),i.chartType&&(this.chartType=i.chartType),i.candleType&&(this.candleType=i.candleType),i.isShowKlineTipPannel&&(this.isShowKlineTipPannel=i.isShowKlineTipPannel),i.zoomLockType&&(this.zoomLockType=i.zoomLockType),i.lastClose&&(this.lastClose=i.lastClose,this.indexPlug.lastClose=this.lastClose),i.sideHeight&&(this.sideHeight=i.sideHeight*this.dpr),i.mobileCross&&(this.mobileCross=i.mobileCross),i.mobileZoom&&(this.mobileZoom=i.mobileZoom*this.dpr),i.page&&(this.page=i.page),i.sides&&(this.sides=i.sides),i.height&&(this.height=i.height*this.dpr),i.width&&(this.width=i.width*this.dpr),i.paddingTop&&(this.paddingTop=i.paddingTop*this.dpr),i.paddingMiddle&&(this.paddingMiddle=i.paddingMiddle*this.dpr),i.paddingBottom&&(this.paddingBottom=i.paddingBottom*this.dpr),i.timeLineTotalModel&&(this.timeLineTotalModel=i.timeLineTotalModel),i.main&&(this.main=this.chartType<=t.dsxConfig.chartType.timeSharing5?["TMA"]:i.main),i.datas&&(this.rawDatas=i.datas),this._dataTransEntity()},n.prototype._initParams=function(){this.lastIndex=null,this.main=this.chartType<=t.dsxConfig.chartType.timeSharing5?["TMA"]:["MA"],this.maxY=0,this.minY=1e9,this.showDatas=[],this.currentData={},this.fingers=0,this.showDateKlines=[],this.startX=0,this.isscrolling=!1,this.crossing=!1,this.zooming=!1,this.lastIndex=null,this.startIndex=0,this.sidesAmount=this.sides?this.sides.length:1,this.page<=1&&(this.scrollX=0,this.lastScrollKlineAmount=0),"string"==typeof this.lastClose&&(this.lastClose=parseFloat(this.lastClose)),null==this.rawDatas&&(this.rawDatas=[]),null==this.datas&&(this.datas=[])},n.prototype._init=function(){this._updateTheme(),this._create()},n.prototype._createAllContext=function(){if(this._createContext(),this.canvas1.style.position="absolute",this.canvas1.getAttribute("width")==this.width&&this.canvas1.getAttribute("height")==this.height||(this.canvas1.style.width=this.width/this.dpr+"px",this.canvas1.style.height=this.height/this.dpr+"px",this.canvas1.setAttribute("width",this.width),this.canvas1.setAttribute("height",this.height)),this.canvas2.style.position="absolute",this.canvas2.getAttribute("width")==this.width&&this.canvas2.getAttribute("height")==this.height||(this.canvas2.style.width=this.width/this.dpr+"px",this.canvas2.style.height=this.height/this.dpr+"px",this.canvas2.setAttribute("width",this.width),this.canvas2.setAttribute("height",this.height)),this.context.fillStyle=this.backgroundColor,this.backgroundImage){var t=new Image;t.src=this.backgroundImage,t.onload=imgfn;var i=canvas.createPattern(t,"no-repeat");this.context.fillStyle=i}this.context.fillRect(0,0,this.width,this.height)},n.prototype._createContext=function(){this.context||(this.element.innerHTML="",this.canvas1=document.createElement("canvas"),this.element.appendChild(this.canvas1),this.context=this.canvas1.getContext("2d")),this.context2||(this.canvas2=document.createElement("canvas"),this.element.appendChild(this.canvas2),this.context2=this.canvas2.getContext("2d"))},n.prototype._setContextSize=function(){if(this.autoSize){var t=this._getParentSize();this.width=t.width*this.dpr,this.height=t.height*this.dpr,this.element.style.width=this.width/this.dpr+"px",this.element.style.height=this.height/this.dpr+"px",this.element.setAttribute("width",this.width),this.element.setAttribute("height",this.height)}this.sideHeight=this.sideHeight||.2*this.height,this.mainHeight=this.height-this.paddingTop-this.paddingMiddle-this.paddingBottom-this.sideHeight*this.sides.length},n.prototype._getParentSize=function(){var t=this.element.parentNode.clientWidth,i=this.element.parentNode.clientHeight;return this.element.parentNode==document.body?this._getWindowSize():{width:t,height:i}},n.prototype._getWindowSize=function(){var t,i;return window.innerWidth?t=window.innerWidth:document.body&&document.body.clientWidth&&(t=document.body.clientWidth),window.innerHeight?i=window.innerHeight:document.body&&document.body.clientHeight&&(i=document.body.clientHeight),{width:t,height:i}},n.prototype._setTimePoints=function(){if(this.chartType<=t.dsxConfig.chartType.timeSharing5){this.times=[];for(var i=(this.timePeriod||this.market).split(","),e=0,s=0;s<i.length;s++){var h=i[s].split("-"),n=h[0],o=h[1],a=n.split(":"),r=parseInt(a[0]),d=parseInt(a[1]),l=o.split(":");e+=60*(parseInt(l[0])-r)+(parseInt(l[1])-d+1),this.times.push(n),this.times.push(o),this.times.push("")}if(this.chartType==t.dsxConfig.chartType.timeSharing5){e*=5;var c=this.rawDatas[0],p=this._transformModel(c,!1);parseInt(p.TIME)!=parseInt(this.times[0].replace(":",""))&&(e-=10*(parseInt(p.TIME)-parseInt(this.times[0].replace(":",""))))}this.totalPoints=e,this.klineWidth=1*this.dpr,this.klinePadding=(this.width-this.dpr)/this.totalPoints-this.klineWidth}else this.chartType!=this.lastChartType&&(this.klineWidth=(this.theme.klineWidth||10)*this.dpr,this.klinePadding=(this.theme.klinePadding||1)*this.dpr)},n.prototype._create=function(){this.startLoading(),this._setTimePoints(),this._dataHandle(),this._drawGridLine(),this._createAllContext(),this._mouseEvent()},n.prototype.startLoading=function(){if(1!=this.isStartLoading){this.isStartLoading=!0,this.theend=!1,this._initParams(),this._setContextSize(),this._setTimePoints(),this._createAllContext(),this._stopLittleCycleAnimation(),this._drawGridLine(),this.onLoading(this);var t=this;setTimeout((function(){t.finishLoading()}),3e3)}},n.prototype.finishLoading=function(){this.isStartLoading=!1;var t=this;setTimeout((function(){t.lockui=!1}),300),console.log("finishLoading")},n.prototype.update=function(t){t&&this.set(t),this.isStartLoading=!1,this._initParams(),this._setContextSize(),this._setTimePoints(),this._createAllContext(),this._update(t)},n.prototype._update=function(t){1!=this.isStartLoading&&(this.isStartLoading=!0,t&&this.set(t),this._clearContext(),this._dataHandle(),this._drawGridLine(),this.zooming||this.isscrolling||this.crossing||this._showTips(),this._drawKlines(),this._drawTimeSharingLine(),this._drawTimeSharingLine5(),this._whenCloseMarketTask(),this._updateComplate())},n.prototype._updateComplate=function(){this.updateComplate(this),this.isStartLoading=!1,this.lastChartType=this.chartType},n.prototype.scrollLeft=function(t){var i=-t*(this.klineWidth+this.klinePadding);this.scroll(i)},n.prototype.scrollRight=function(t){var i=t*(this.klineWidth+this.klinePadding);this.scroll(i)},n.prototype.scroll=function(i){1!=this.isStartLoading&&(this.chartType<=t.dsxConfig.chartType.timeSharing5||this.crossing||this.zooming||(this.crossIsFinished=!0,this.scrollX=i,this.isscrolling=!0,this.crossing=!1,this._update(),this._showTips()))},n.prototype.zoom=function(i,e){1!=this.isStartLoading&&(this.chartType<=t.dsxConfig.chartType.timeSharing5||(this.zooming=!0,this.zoomx=e,this.klineWidth+=i,this.klineWidth=Math.max(this.zoomMin,this.klineWidth),this.klineWidth=Math.min(this.zoomMax,this.klineWidth),this.klineWidth!=n.lastKlineWidth&&(this._update(),this._showTips(),this.scrollX=0,n.lastKlineWidth=this.klineWidth,this.lastIndex=this.startIndex,0==this.startIndex&&(this.isScrollLeftStart=!0,this._scrollLeftLoadMoreData()))))},n.prototype.enlarge=function(t){var i=this.zoomstep*this.dpr;this.zoom(i,t)},n.prototype.shrink=function(t){var i=-this.zoomstep*this.dpr;this.zoom(i,t)},n.prototype.cross=function(t,i){this.isscrolling||this.zooming||1!=this.isStartLoading&&(this.isMouseDown=!0,this.crossing=!0,this.isscrolling=!1,this.crossIsFinished=!1,this._update(),this._drawCrossLine(t,i))},n.prototype.crossHidden=function(){this.zooming||1!=this.isStartLoading&&1!=this.crossIsFinished&&(this.isStartLoading=!1,this.isMouseDown=!0,this.zooming=!1,this.isscrolling=!1,this.crossing=!1,this._update(),this.crossIsFinished=!0)},n.prototype.scrollThenend=function(){this.theend=!0,this.isStartLoading=!1},n.prototype.refreshLastOneData=function(i,e){var s=this;function h(t,i){var e=Math.max(t.HIGH,i.HIGH),s=Math.min(t.LOW,i.HIGH),h=Math.max(0,parseFloat(t.VOL)+parseFloat(i.VOL)),n=Math.max(0,parseFloat(t.AMOUNT)+parseFloat(i.AMOUNT),0),o=[i.DATE,t.OPEN,e,s,i.CLOSE,h,n];return i.TIME&&(o=[i.DATE,i.TIME,t.OPEN,e,s,i.CLOSE,h,n]),o.join(",")}function n(t,i,e){var h=0,n=0;if(e.startsWith("m")||e.startsWith("h")||e.startsWith("t5"))for(var o=s.datas.length-1;o>=0;o--){var a=s.datas[o];if(a.DATE!=t)break;a.TIME!=i&&(n+=parseFloat(a.AMOUNT),h+=parseFloat(a.VOL))}else for(var r=0;r<s.datas.length;r++){var d=s.datas[r];if(d.DATE!=t)break;d.TIME!=i&&(n+=parseFloat(d.AMOUNT),h+=parseFloat(d.VOL))}return{vol:h,amount:n}}if(i&&!this.crossing&&!this.isscrolling&&!this.zooming&&!this.isStartLoading){var o=this._isMin(),a=this._transformModel(i,o);if(a.OPEN<=0)return;if(a.TIME&&a.TIME<parseInt(this.times[0].replace(":","")))return;var r=this.rawDatas.length>0?this._transformModel(this.rawDatas[this.rawDatas.length-1],o):null;if(null==r)this.rawDatas=[i];else{var d=r.DATE,l=r.TIME;if(l){if(l==this.times[this.times.length-2].replace(":",""))return;if(a.TIME<l)return;if("m"==e&&(e="m1"),"h"==e&&(e="h1"),l==a.TIME){if(this.chartType,t.dsxConfig.chartType.timeSharing5,this.chartType==t.dsxConfig.chartType.candle){if(r.CLOSE==a.CLOSE)return;var c=n(a.DATE,a.TIME,e);r.VOL=-c.vol,r.AMOUNT=-c.amount,i=h(r,a)}else if(!this.timeLineTotalModel){var p=n(a.DATE,a.TIME,e);if(parseFloat(a.VOL)<p.vol)return;i=[a.DATE,a.TIME,a.CLOSE,parseFloat(a.VOL)-p.vol,parseFloat(a.AMOUNT)-p.amount].join(",")}this.rawDatas[this.rawDatas.length-1]=i}else{var g=n(a.DATE,r.TIME,e);if(this.chartType==t.dsxConfig.chartType.candle){if(i=[a.DATE,a.TIME,a.OPEN,a.HIGH,a.LOW,a.CLOSE,parseFloat(a.VOL)-g.vol,parseFloat(a.AMOUNT)-g.amount].join(","),e.startsWith("m")){var f=parseInt(e.replace("m","")),u=parseInt(r.TIME),m=parseInt(u/100)+parseInt((u%100+f)/60),T=parseInt(m+""+(u%100+f)%60);parseInt(a.TIME)<=T?(r.VOL=-g.vol,r.AMOUNT=-g.amount,i=h(r,a),this.rawDatas[this.rawDatas.length-1]=i):this.rawDatas.push(i)}if(e.startsWith("h")){var x=parseInt(e.replace("h",""));x*=60;var y=parseInt(r.TIME),I=parseInt(Math.t/100)+parseInt((y%100+x)/60)+(y%100+x)%60;parseInt(a.TIME)<=I?(r.VOL=-g.vol,r.AMOUNT=-g.amount,i=h(r,a),this.rawDatas[this.rawDatas.length-1]=i):this.rawDatas.push(i)}}else this.timeLineTotalModel||(i=[a.DATE,a.TIME,a.CLOSE,parseFloat(a.VOL)-g.vol,parseFloat(a.AMOUNT)-g.amount].join(",")),this.rawDatas.push(i)}}else if(d==a.DATE){if(r.CLOSE==a.CLOSE&&r.OPEN==a.OPEN&&r.HIGH==a.HIGH&&r.LOW==a.LOW)return;i=function(t,i,e){var s=t.OPEN<=0?i.OPEN:t.OPEN,h=Math.max(t.HIGH,i.CLOSE),n=Math.min(t.LOW,i.CLOSE),o="d"==e?i.VOL:t.VOL,a="d"==e?i.AMOUNT:t.AMOUNT;return[i.DATE,s,h,n,i.CLOSE,o,a].join(",")}(r,a,e),this.rawDatas[this.rawDatas.length-1]=i}else{var S=a.DATE.substr(0,4)+"/"+a.DATE.substr(4,2)+"/"+a.DATE.substr(6,2)+" 00:00:00",C=d.substr(0,4)+"/"+d.substr(4,2)+"/"+d.substr(6,2)+" 00:00:00",w=new Date(S),v=new Date(C);if("d"==e&&this.rawDatas.push(i),"w"==e){var L=7-(v.getDay()>0?v.getDay():7),M=new Date(v.getTime()+24*L*3600*1e3);w.getTime()<M.getTime()?(i=h(r,a),this.rawDatas[this.rawDatas.length-1]=i):this.rawDatas.push(i)}"m"==e&&(w.getMonth()==v.getMonth()?(i=h(r,a),this.rawDatas[this.rawDatas.length-1]=i):this.rawDatas.push(i)),"y"==e&&(w.getFullYear()==v.getFullYear()?(i=h(r,a),this.rawDatas[this.rawDatas.length-1]=i):this.rawDatas.push(i))}}if(this.chartType==t.dsxConfig.chartType.candle&&this.showDatas.length>0){var A=this.datas[this.datas.length-1],O=this.showDatas[this.showDatas.length-1];if(A.INDEX!=O.INDEX)return}this.update({datas:this.rawDatas})}},n.prototype.refreshLastOneDataMySelf=function(i){if(this.chartType==t.dsxConfig.chartType.candle&&this.showDatas.length>0){var e=this.datas[this.datas.length-1],s=this.showDatas[this.showDatas.length-1];if(e.INDEX!=s.INDEX)return}this.update({datas:i})},n.prototype._scrollLeftLoadMoreData=function(){!this.nextPage&&this.scrollLeftCallBack&&(this.nextPage=this.scrollLeftCallBack),this.nextPage&&!this.scrollLeftCallBack&&(this.scrollLeftCallBack=this.nextPage),this.chartType!=t.dsxConfig.chartType.candle||!this.scrollLeftCallBack||!this.isScrollLeftStart||this.crossing||this.zooming||this.theend?this.isStartLoading=!1:(this.isStartLoading=!0,this.lockui=!0,console.log("loading more datas..."),this.isScrollLeftStart=!1,this.lastScrollKlineAmount=this.datas.length,this.scrollLeftCallBack(this.currentData,this.currentIndex))},n.prototype._dataTransEntity=function(){var i=this,e=this.rawDatas.length;if(this.datas=[],!(e<=0)){var s=[],h=0,n=this._isMin(),o=this,a=0,r=0,d=0,l=0;this.rawDatas.forEach((function(e,c){var p=o._transformModel(e,n);p.INDEX=c,p.TIMEINDEX=h,i.chartType==t.dsxConfig.chartType.timeSharing5&&(parseInt(p.TIME)<r&&(h=0,d=0,l=0),p.TIMEINDEX=h);var g=p.VOL,f=p.AMOUNT;i.chartType<=t.dsxConfig.chartType.timeSharing5&&i.timeLineTotalModel&&(p.VOL=parseFloat(p.VOL)-d,p.AMOUNT=parseFloat(p.AMOUNT)-l),d=g,l=f,r=parseInt(p.TIME),h++,p.ZHIBIAO={},p.LASTCLOSE=a,a=p.CLOSE,"string"==typeof p.OPEN&&(p.OPEN=parseFloat(p.OPEN)),"string"==typeof p.HIGH&&(p.HIGH=parseFloat(p.HIGH)),"string"==typeof p.LOW&&(p.LOW=parseFloat(p.LOW)),"string"==typeof p.CLOSE&&(p.CLOSE=parseFloat(p.CLOSE)),"string"==typeof p.VOL&&(p.VOL=parseFloat(p.VOL)),"string"==typeof p.AMOUNT&&(p.AMOUNT=parseFloat(p.AMOUNT)),s.push(p),p=null,o.main.forEach((function(t){o.indexPlug.get(t,c,s,o.lastClose)})),o.sides.forEach((function(t){o.indexPlug.get(t,c,s,o.lastClose)}))})),this.datas=s,s=null}},n.prototype._isMin=function(){var i=!1;if(this.chartType==t.dsxConfig.chartType.candle)for(var e=0;e<this.rawDatas.length;e++){var s=this.rawDatas[e].split(",");if(s.length<2)break;var n=s[0],o=s[1];try{if(o.indexOf(".")>0)break;if((o=parseInt(o))<1e3?o="0"+o:o+="",8!=n.length)break;if(4!=o.length)break;var a=parseInt(n.substr(0,4)),r=parseInt(n.substr(4,2)),d=parseInt(n.substr(6,2)),l=parseInt(o.substr(0,2)),c=parseInt(o.substr(2,2)),p=new Date(a,r,d,l,c,0);if("object"===h(p)&&p.getFullYear()==a&&p.getMonth()==r&&p.getDate()==d&&p.getHours()==l&&p.getMinutes()==c){i=!0;break}}catch(t){this.showDebug(t)}}return i},n.prototype._transformModel=function(i,e){for(var s=i.split(","),h={},n=0;n<s.length;n++){var o=s[n];this.chartType==t.dsxConfig.chartType.candle&&(e&&n>0?1==n?h[t.dsxConfig.entity.candle[t.dsxConfig.entity.candle.length-1]]=o:h[t.dsxConfig.entity.candle[n-1]]=o:h[t.dsxConfig.entity.candle[n]]=o),this.chartType<=t.dsxConfig.chartType.timeSharing5&&(h[t.dsxConfig.entity.timeSharing[n]]=o)}return h},n.prototype._dataHandle=function(){var i=this;if(this.datas&&!this.crossing){var e=this.datas.length;if(e<=0)return!1;this.chartType==t.dsxConfig.chartType.candle&&(e+=this.chartType==t.dsxConfig.chartType.candle?this.rightEmptyKlineAmount:0);var s=this._getPageSize();if(Math.abs(this.scrollX)<this.klineWidth/2&&0!=this.scrollX)return!1;var h=0!=this.scrollX?this._getPageSize(this.scrollX):0,n=e-s;this.scrollAmount=h;var o=(null!=this.lastIndex?this.lastIndex:n)-this.scrollAmount;if(this.chartType<=t.dsxConfig.chartType.timeSharing&&(o=0,s=this.totalPoints),this.lastScrollKlineAmount>0&&(o=e-this.lastScrollKlineAmount,this.chartType==t.dsxConfig.chartType.candle&&(o-=this.chartType==t.dsxConfig.chartType.candle?this.rightEmptyKlineAmount:0),this.lastIndex=o,this.lastScrollKlineAmount=0),this.zooming&&this.zoomindex>0&&this.zoomx>0){var a=this._getPageSize(this.zoomx);o=this.zoomindex-a}if(o>=n?(this.lastIndex=n,this.isScrollRightEnd=!0,o=n,this.scrollX=0,this.scrollAmount=0):this.isScrollRightEnd=!1,o<=0?(o=0,this.lastIndex=0,this.scrollX=0,this.scrollAmount=0):(this.isScrollLeftStart=!1,this.lastScrollKlineAmount=0),o==this.startIndex&&this.startIndex>0)return!1;this.startIndex=o;var r=o+s;r>=e&&(r=e),this.showDatas=this.datas.slice(o,r),this.maxY=0,this.minY=1e9;var d=this;this.main.forEach((function(t){i.indexMaxMin[t]={MAX:0,MIN:1e9}})),this.sides.forEach((function(t){i.indexMaxMin[t]={MAX:0,MIN:1e9}})),this.highIndex=-1,this.lowIndex=-1;var l,c=0,p=this.minY;this.showDateKlines=[];var g=this.width/3,f=this._getPageSize(g);this.chartType==t.dsxConfig.chartType.timeSharing5&&(this.times5=[]);for(var u=0;u<this.showDatas.length;u++){var m=this.showDatas[u];this.chartType<=t.dsxConfig.chartType.timeSharing5?(this.maxY=Math.max(this.maxY,m.CLOSE),this.minY=Math.min(this.minY,m.CLOSE)):(this.maxY=Math.max(this.maxY,m.HIGH),this.minY=Math.min(this.minY,m.LOW),parseFloat(m.HIGH)>c&&(c=parseFloat(m.HIGH),this.highIndex=u),parseFloat(m.LOW)<p&&(p=parseFloat(m.LOW),this.lowIndex=u)),m.CURRENTINDEX=u,this.chartType==t.dsxConfig.chartType.candle&&(m.SHOWDATE=m.INDEX%f==0),this.chartType==t.dsxConfig.chartType.timeSharing&&(m.SHOWDATE=this.times.indexOf(m.TIME)>=0),this.chartType==t.dsxConfig.chartType.timeSharing5&&this.times5.indexOf(m.DATE)<0&&this.times5.push(m.DATE),m.SHOWDATE&&this.showDateKlines.push(m),this.main.forEach((function(t){d._setMaxMin(t,m);var i=d.indexMaxMin[t];d.maxY=Math.max(d.maxY,i.MAX),d.minY=Math.min(d.minY,i.MIN)})),this.sides.forEach((function(t){d._setMaxMin(t,m)})),m.LASTITEM=l;var T=JSON.parse(JSON.stringify(m));T.LASTITEM=null,l=T}if(Object.keys(this.indexMaxMin).forEach((function(t){var i=d.indexMaxMin[t],e=i.MAX-i.MIN;i.MAX+=.2*e})),1e9==this.minY)return!1;this.chartType==t.dsxConfig.chartType.candle&&(this.maxY+=.1*(this.maxY-this.minY),this.minY-=.1*(this.maxY-this.minY)),this.currentData=l,this.currentIndex=l.CURRENTINDEX}return!0},n.prototype._setMaxMin=function(i,e){if(e){var s=t.dsxConfig.index[i].value,h=this.indexMaxMin[i]||{MAX:0,MIN:1e9};if(Object.keys(s).forEach((function(t){var s=e.ZHIBIAO[i][t];null!=s&&(h.MAX=Math.max(h.MAX,s),h.MIN=Math.min(h.MIN,s))})),"MACD"==i){var n=Math.max(Math.abs(h.MAX),Math.abs(h.MIN));h.MAX=n,h.MIN=-n}this.indexMaxMin[i]=h}},n.prototype._getMiddleKlineLineIndex=function(t){if(0!=this.zoomx){var i=this._getPageSize(this.zoomx);i=this.startIndex+i,this.zoomindex=i}},n.prototype._getPageSize=function(t){return null==t&&(t=this.width),Math.round(t/(this.klineWidth+this.klinePadding))},n.prototype._clearContext=function(){this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height)},n.prototype._drawGridLine=function(){this._drawGridSideLine(),this._showYTips(),this._showXTips()},n.prototype._drawGridSideLine=function(){for(var t=this.width,i=0;i<=this.sidesAmount;i++){var e=this.paddingTop+this.paddingMiddle+this.mainHeight+this.sideHeight*i,s=e;this._drawLine(0,e,t,s,this.gridLineWidth,this.gridLineColor)}},n.prototype._getKlineXByScrollX=function(t){var i=this._getPageSize(t),e=this.startX,s=(i-1)*(this.klineWidth+this.klinePadding)+e-this.klinePadding,h=i*(this.klineWidth+this.klinePadding)+e,n=(i+1)*(this.klineWidth+this.klinePadding)+e;return t>h&&t<n?{x:h,index:i}:t>n?{x:n,index:i+1}:t<h&&t>s?{x:s,index:i-1}:{x:h,index:i}},n.prototype._drawCrossLine=function(t,i){if(this.crossing){t*=this.dpr;var e=this._getKlineXByScrollX(t).index;e>=this.showDatas.length&&(e=this.showDatas.length-1);var s=e*(this.klineWidth+this.klinePadding)+this.klineWidth/2+this.startX,h=this.paddingTop,n=s,o=h+this.mainHeight;this._drawLine(s,h,n,o,this.crossLineWidth,this.crossLineColor),o+=(h=o+this.paddingMiddle)+this.sideHeight*this.sides.length,this._drawLine(s,h,n,o,this.crossLineWidth,this.crossLineColor),o=h=Math.min(this.height-this.paddingBottom,Math.max(this.paddingTop,i*this.dpr)),n=this.width,(h<=this.paddingTop+this.mainHeight||h>=this.paddingTop+this.mainHeight+this.paddingMiddle)&&this._drawLine(0,h,n,o,this.crossLineWidth,this.crossLineColor),this.currentIndex=e,this.currentData=this.showDatas[e],this._showTips(),this._showXTips(s,h),this._showKlineTips()}},n.prototype._drawLine=function(t,i,e,s,h,n){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];this.context.strokeStyle=n,this.context.lineWidth=h,this.context.beginPath(),this.context.lineJoin="round",o&&this.context.setLineDash(o),this.context.moveTo(t,i),this.context.lineTo(e,s),this.context.closePath(),this.context.stroke()},n.prototype._drawKlines=function(){var i=0;if(this.chartType==t.dsxConfig.chartType.candle&&0!=this.startIndex){var e=this.showDatas.length,s=this._getPageSize(),h=e*(this.klineWidth+this.klinePadding)-this.klinePadding;i=this.width-h;var n=this.startIndex-(this.datas.length-s);n<=this.rightEmptyKlineAmount&&n>0&&0!=this.startIndex&&(i-=n*(this.klineWidth+this.klinePadding))}this.startX=i;for(var o=null,a=0;a<this.showDatas.length;a++){var r=this.showDatas[a],d=r.OPEN,l=r.HIGH,c=r.LOW,p=r.CLOSE;this.chartType==t.dsxConfig.chartType.candle&&this._drawOneKline(i,d,l,c,p),this._drawAllIndex(i,r,o),i+=this.klineWidth+this.klinePadding,o=r,this.currentData=r}},n.prototype._drawTimeSharingLine=function(){if(this.chartType==t.dsxConfig.chartType.timeSharing){var i=this.dpr;this.startX=i;var e=this.paddingTop,s=this.mainHeight,h=this.maxY,n=this.minY;this.context.strokeStyle=this.timeSharingLineColor,this.context.lineWidth=this.lineWidth,this.context.beginPath(),this.context.lineJoin="round";for(var o=0;o<this.showDatas.length;o++){var a=this.showDatas[o];e=(h-a.CLOSE)/(h-n)*s+this.paddingTop,0==o?this.context.moveTo(i,e):this.context.lineTo(i,e),i+=this.klineWidth+this.klinePadding,this.currentData=a}if(this.context.stroke(),this.context.closePath(),this._drawLittleCycleAnimation(i-(this.klineWidth+this.klinePadding),e),this.timeSharingLineFillColor){i=this.dpr,e=this.paddingTop,this.context.beginPath(),this.context.moveTo(i,s+this.paddingTop);for(var r=0;r<this.showDatas.length;r++)e=(h-this.showDatas[r].CLOSE)/(h-n)*s+this.paddingTop,this.context.lineTo(i,e),i+=this.klineWidth+this.klinePadding;this.context.lineTo(i-(this.klineWidth+this.klinePadding),s+this.paddingTop),this.context.fillStyle=this.timeSharingLineFillColor,this.context.fill(),this.context.closePath()}}},n.prototype._drawTimeSharingLine5=function(){if(this.chartType==t.dsxConfig.chartType.timeSharing5){var i=this.dpr;this.startX=i;var e=this.paddingTop,s=this.mainHeight,h=this.maxY,n=this.minY;this.context.strokeStyle=this.timeSharingLineColor,this.context.lineWidth=this.lineWidth,this.context.beginPath(),this.context.lineJoin="round";for(var o=0;o<this.showDatas.length;o++){var a=this.showDatas[o],r=parseFloat(a.CLOSE);a.LASTITEM&&(e=(h-r)/(h-n)*s+this.paddingTop,parseInt(a.TIME)<parseInt(a.LASTITEM.TIME)?(this.context.stroke(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(i,e)):this.context.lineTo(i,e),i+=this.klineWidth+this.klinePadding,this.currentData=a)}if(this.context.stroke(),this.context.closePath(),this._drawLittleCycleAnimation(i-(this.klineWidth+this.klinePadding),e),this.timeSharingLineFillColor){i=this.dpr,e=this.paddingTop,this.context.beginPath(),this.context.moveTo(i,s+this.paddingTop);for(var d=0;d<this.showDatas.length;d++)e=(h-(r=this.showDatas[d].CLOSE))/(h-n)*s+this.paddingTop,this.context.lineTo(i,e),i+=this.klineWidth+this.klinePadding;this.context.lineTo(i-(this.klineWidth+this.klinePadding),s+this.paddingTop),this.context.fillStyle=this.timeSharingLineFillColor,this.context.fill(),this.context.closePath()}}},n.prototype._drawAllIndex=function(i,e,s){var h=this;if(this.chartType==t.dsxConfig.chartType.timeSharing5){if(!e.LASTITEM)return;if(parseInt(e.TIME)<parseInt(e.LASTITEM.TIME))return}var n=this.lineWidth,o=this,a=this.sideHeight,r=this.mainHeight,d=o.maxY,l=o.minY;this.main.forEach((function(n){var c=t.dsxConfig.index[n],p=c.value,g=c.draw;c.chartType.indexOf(o.chartType)<0||c.location.indexOf("main")<0||Object.keys(p).forEach((function(t){var c=e.ZHIBIAO[n][t],p=s?s.ZHIBIAO[n][t]:0,f=g[t];if(!(p<=0)&&f){var u=i-o.klineWidth/2-o.klinePadding,m=(d-p)/(d-l)*r+o.paddingTop;"line"!=f.model&&(u=i,m=r+(d-c)/(d-l)*a+o.paddingTop);var T=i+o.klineWidth/2,x=(d-c)/(d-l)*r+o.paddingTop;o._drawIndex(u,m,T,x,f.color,f.model,h.lineWidth,e.OPEN,e.CLOSE)}}))})),this.sides.forEach((function(d,l){var c=h.indexMaxMin[d],p=c.MAX,g=c.MIN;"VOL"==d&&(g=0);var f=t.dsxConfig.index[d],u=f.value,m=f.draw;f.chartType.indexOf(o.chartType)<0||f.location.indexOf("sides")<0||Object.keys(u).forEach((function(c){var f=e.ZHIBIAO[d][c],u=s?s.ZHIBIAO[d][c]:null,T=m[c];if(T&&("line"!=T.model||null!=u)){var x=i-o.klineWidth/2-o.klinePadding,y=r+o.paddingTop+o.paddingMiddle+a*l+(p-u)/(p-g)*a;"line"!=T.model&&(x=i,y=r+o.paddingTop+o.paddingMiddle+a*l+(p-f)/(p-g)*a,"MACD"==c&&(x=i+o.klineWidth/2-h.lineWidth,y=f>0?r+o.paddingTop+o.paddingMiddle+a*l+(p-f)/p*a/2:a/2+r+o.paddingTop+o.paddingMiddle+a*l));var I=i+o.klineWidth/2,S=r+a*l+a+o.paddingTop+o.paddingMiddle;if("line"==T.model?(n=h.lineWidth,S=r+a*l+(p-f)/(p-g)*a+o.paddingTop+o.paddingMiddle):(n=h.klineWidth,"MACD"==c&&(I=x,n=h.lineWidth,f>0?(S=r+a*l+a/2+o.paddingTop+o.paddingMiddle,T.color=h.red):(S=a/2+r+a*l+Math.abs(f)/p*a/2+o.paddingTop+o.paddingMiddle,T.color=h.green))),h.chartType<=t.dsxConfig.chartType.timeSharing5&&"VOL"==d){if("VOL"!=c)return;var C=T.color,w=e.LASTITEM?e.LASTITEM.CLOSE:h.lastClose;return e.CLOSE>=w&&(C=h.red),e.CLOSE<w&&(C=h.green),void o._drawIndex(x,y,I,S,C,T.model,n,e.OPEN,e.CLOSE)}o._drawIndex(x,y,I,S,T.color,T.model,n,e.OPEN,e.CLOSE)}}))}))},n.prototype._drawOneKline=function(i,e,s,h,n){var o=this.paddingTop+(this.maxY-e)/(this.maxY-this.minY)*this.mainHeight,a=this.paddingTop+(this.maxY-n)/(this.maxY-this.minY)*this.mainHeight,r=this.paddingTop+(this.maxY-s)/(this.maxY-this.minY)*this.mainHeight,d=this.paddingTop+(this.maxY-h)/(this.maxY-this.minY)*this.mainHeight,l=e>n?this.green:e==n?this.fontColor:this.red;this.context.fillStyle=l;var c=1*this.dpr,p=i+this.klineWidth/2,g=a-o;0==g&&(g=this.dpr),this.candleType==t.dsxConfig.candleType.hollow&&n>e?(this.context.fillStyle=null,this.context.strokeStyle=l,this.context.strokeRect(i+c/2,o+c/2,this.klineWidth-1*c,g-1*c),r!=a&&this._drawLine(p,r,p,a-c,c,l),d!=o&&this._drawLine(p,o+c,p,d,c,l)):(this.context.fillRect(i,o,this.klineWidth,Math.max(this.dpr,g)),this._drawLine(p,r,p,d,c,l))},n.prototype._drawIndex=function(i,e,s,h,n,o,a,r,d){i!=1/0&&e!=1/0&&s!=1/0&&h!=1/0&&("line"==o&&this._drawLine(i,e,s,h,a,n),"column"==o&&(a==this.klineWidth&&this.chartType==t.dsxConfig.chartType.candle?(n=r>d?this.green:r==d?this.fontColor:this.red,d>r&&r>0&&d>0&&this.candleType==t.dsxConfig.candleType.hollow?(this.context.fillStyle=null,this.context.strokeStyle=n,this.context.strokeRect(i+.5*this.dpr,e,a-1*this.dpr,h-e-1*this.dpr)):(this.context.fillStyle=n,this.context.fillRect(i,e,a,h-e))):(this.context.fillStyle=n,this.context.fillRect(i,e,a,h-e))),"cycle"==o&&(this.context.beginPath(),this.context.fillStyle=n,this.context.arc(i,e,a/2,0,2*Math.PI),this.context.fill()))},n.prototype._drawText=function(t,i,e,s,h){this.context.font=e+"px 微软雅黑",this.context.fillStyle=s,this.context.fillText(h,t,i)},n.prototype._getTextSize=function(t,i){return this.context.font=t+"px 微软雅黑",this.context.measureText(i)},n.prototype._drawRoundRect=function(t,i,e,s,h,n){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e<2*h&&(h=e/2),s<2*h&&(h=s/2),this.context.beginPath(),this.context.moveTo(t+h,i),this.context.arcTo(t+e,i,t+e,i+s,h),this.context.arcTo(t+e,i+s,t,i+s,h),this.context.arcTo(t,i+s,t,i,h),this.context.arcTo(t,i,t+e,i,h),this.context.closePath(),o&&(this.context.fillStyle=n,this.context.fill()),o||(this.context.strokeStyle=n,this.context.stroke())},n.prototype._whenCloseMarketTask=function(){if(this.chartType<=t.dsxConfig.chartType.timeSharing5&&this.datas.length>0&&this.times.length>1)for(var i=this.datas[this.datas.length-1],e=this.market.split(","),s=0;s<e.length;s++)e[s].split("-")[1].replace(":","")==i.TIME&&this._stopLittleCycleAnimation()},n.prototype._stopLittleCycleAnimation=function(){(this.dsxLittleCycleTImer||this.chartType==t.dsxConfig.chartType.candle)&&(clearInterval(this.dsxLittleCycleTImer),this.dsxLittleCycleTImer=null,this.context2.clearRect(0,0,this.width,this.height))},n.prototype._drawLittleCycleAnimation=function(t,i){if(!(this.datas.length<=0||this.crossing||this.zooming||this.isscrolling)){clearInterval(this.dsxLittleCycleTImer);var e=2*this.dpr,s=1*this.dpr,h=10*this.dpr,n=2*this.dpr,o=this.context2,a=this.width,r=this.height,d=this.timeSharingLineColor;this.dsxLittleCycleTImer=setInterval((function(){o.clearRect(0,0,a,r),o.beginPath(),o.arc(t,i,e,0,2*Math.PI,!0),o.closePath(),o.fillStyle=d,o.globalAlpha=1-e/h,o.fill(),o.beginPath(),o.arc(t,i,n,0,2*Math.PI,!0),o.closePath(),o.fillStyle=d,o.globalAlpha=1,o.fill(),(e+=s)>h&&(e=n)}),120)}},n.prototype._showTips=function(){if(this.onCrossing&&!this.showTipCallback&&(this.showTipCallback=this.onCrossing),null!=this.showTipCallback){var t=null!=this.currentData?JSON.parse(JSON.stringify(this.currentData)):this.currentData;if(t&&(t.LASTITEM=null),1==this.showTipCallback(t,this.currentIndex))return}this._showMainTips(),this._showSideTips(),this._showMaxMinKlineHighTip()},n.prototype._showYTips=function(){if(0!=this.maxY&&this.maxY){if(this.chartType==t.dsxConfig.chartType.candle)for(var i=this.maxY,e=this.minY,s=this.gridLineCount,h=this.mainHeight,n=3*this.dpr,o=this.paddingTop,a=0;a<=s;a++){o=h/s*a+this.paddingTop;var r=i-(i-e)/s*a;r=r.toFixed(this.decimalPoint),this.log(r,n,o),this._drawLine(0,o,this.width,o,this.gridLineWidth,this.gridLineColor),o+=this.fontSize/2-this.gridLineWidth/2,0==a&&(o+=this.fontSize-this.fontSize/2+3*this.dpr),a==s&&(o-=this.fontSize),this._drawText(n,o,this.fontSize,this.fontColor,r)}if(this.chartType<=t.dsxConfig.chartType.timeSharing5){var d=this.maxY,l=this.minY;d=this.lastClose+Math.max(Math.abs(d-this.lastClose),Math.abs(this.lastClose-l)),l=this.lastClose-(d-this.lastClose),this.maxY=d,this.minY=l;for(var c=this.mainHeight,p=3*this.dpr,g=this.paddingTop,f=0;f<=2;f++)if(g=c/2*f+this.paddingTop,1==f){this._drawLine(0,g,this.width,g,this.gridLineWidth,this.gridLineColor,[3,6]),this._drawText(p,g+this.fontSize/2-this.gridLineWidth,this.fontSize,this.fontColor,this.lastClose);var u="0.00%",m=this._getTextSize(this.fontSize,u);this._drawText(this.width-m.width-3*this.dpr,g+this.fontSize/2-this.gridLineWidth,this.fontSize,this.fontColor,u)}else{this._drawLine(0,g,this.width,g,this.gridLineWidth,this.gridLineColor);var T=d-(d-l)/2*f,x=(T=T.toFixed(this.decimalPoint))>this.lastClose?this.red:this.green;this.log(T,p,g),g+=this.fontSize/2-this.gridLineWidth/2,0==f&&(g+=this.fontSize-this.fontSize/2+3*this.dpr),2==f&&(g-=this.fontSize),this._drawText(p,g,this.fontSize,x,T);var y=((T-this.lastClose)/this.lastClose*100).toFixed(this.decimalPoint)+"%",I=this._getTextSize(this.fontSize,y);this._drawText(this.width-I.width-3*this.dpr,g,this.fontSize,x,y)}}}},n.prototype._showXTips=function(i,e){var s=this,h=this.mainHeight,n=h+this.paddingTop+this.paddingMiddle/2-(6*this.dpr+this.fontSize)/2;if(i){if(null==this.datas)return;if(this.datas.length<=0)return;var o=this.currentData;if(!o)return;var a=o.DATE;this.chartType==t.dsxConfig.chartType.candle&&o.TIME&&(a=o.TIME,a=o.DATE.substr(4)+" "+a.substr(0,2)+":"+a.substr(2,2)),this.chartType==t.dsxConfig.chartType.timeSharing&&(a=(a=o.TIME).substr(0,2)+":"+a.substr(2,2)),this.chartType==t.dsxConfig.chartType.timeSharing5&&(a=o.TIME,a=o.DATE.substr(4)+" "+a.substr(0,2)+":"+a.substr(2,2));var r=this._getTextSize(this.fontSize,a);(i-=r.width/2)<=0&&(i=3*this.dpr),i+r.width>=this.width&&(i=this.width-r.width);var d=e;e<=this.paddingTop+this.fontSize/2+3*this.dpr&&(d=this.paddingTop+this.fontSize/2+3*this.dpr),e>=this.height-this.paddingBottom-this.fontSize/2-6*this.dpr/2&&(d=this.height-this.paddingBottom-this.fontSize/2-6*this.dpr/2),this._drawRoundRect(i-3*this.dpr,n,r.width+6*this.dpr,6*this.dpr+this.fontSize,2*this.dpr,this.fontBgColor,!1),this._drawRoundRect(i-3*this.dpr+this.dpr,n+this.dpr,r.width+6*this.dpr-2*this.dpr,6*this.dpr+this.fontSize-2*this.dpr,2*this.dpr,this.backgroundColor),this._drawText(i,n+3*this.dpr+this.fontSize-this.dpr,this.fontSize,this.fontBgColor,a);var l=this.maxY-(this.maxY-this.minY)*(e-this.paddingTop)/h,c=this.paddingTop+this.mainHeight+this.paddingMiddle,p=this;if(this.sides.forEach((function(t){if(e>=c){var i=p.indexMaxMin[t];if(i){var s=i.MAX,h=i.MIN;l=s-(s-h)*(e-c)/p.sideHeight}}c+=p.sideHeight})),l=this._number(l),r=this._getTextSize(this.fontSize,l),e>this.paddingTop+this.mainHeight&&e<this.paddingTop+this.mainHeight+this.paddingMiddle)return;return this._drawRoundRect(0,d-this.fontSize/2-3*this.dpr,r.width+6*this.dpr,6*this.dpr+this.fontSize,2*this.dpr,this.fontBgColor,!1),this._drawRoundRect(0+this.dpr,d-this.fontSize/2-3*this.dpr+this.dpr,r.width+6*this.dpr-2*this.dpr,6*this.dpr+this.fontSize-2*this.dpr,2*this.dpr,this.backgroundColor),void this._drawText(3*this.dpr,d+3*this.dpr+this.crossLineWidth/2,this.fontSize,this.fontBgColor,l)}if(e=n+3*this.dpr+this.fontSize-this.dpr,this.chartType==t.dsxConfig.chartType.candle&&this.showDateKlines.forEach((function(t){i=(t.INDEX-s.startIndex)*(s.klineWidth+s.klinePadding)+s.klineWidth/2+s.startX;var h=t.DATE;t.TIME&&(h=(h=t.TIME).substr(0,2)+":"+h.substr(2,2));var n=s._getTextSize(s.fontSize,h);s._drawLine(i-s.gridLineWidth/2,s.paddingTop,i-s.gridLineWidth/2,s.paddingTop+s.mainHeight,s.gridLineWidth,s.gridLineColor),s._drawLine(i-s.gridLineWidth/2,s.paddingTop+s.mainHeight+s.paddingMiddle,i-s.gridLineWidth/2,s.height-s.paddingBottom,s.gridLineWidth,s.gridLineColor),i<=n.width&&(i=3*s.dpr+n.width/2),s._drawText(i-n.width/2,e,s.fontSize,s.fontColor,h)})),this.chartType==t.dsxConfig.chartType.timeSharing){var g=this.dpr,f=0;this.times.forEach((function(t,i){if(""!=t){var h=parseInt(t.replace(":",""));0==i&&(f=h),0==f&&(f=h);var n=60*(parseInt(h/100)-parseInt(f/100))+(h%100-f%100),o=g+n/s.totalPoints*(s.width-2*s.gridLineWidth);g+=o;var a=t,r=s._getTextSize(s.fontSize,a);""!=s.times[i+1]&&0!=i&&(s._drawLine(o-s.gridLineWidth,s.paddingTop,o-s.gridLineWidth,s.paddingTop+s.mainHeight,s.gridLineWidth,s.gridLineColor),s._drawLine(o-s.gridLineWidth,s.paddingTop+s.mainHeight+s.paddingMiddle,o-s.gridLineWidth,s.height-s.paddingBottom,s.gridLineWidth,s.gridLineColor)),o<=r.width&&(o=3*s.dpr+r.width/2),i+2!=s.times.length?(""==s.times[i+1]?s._drawText(o-r.width,e,s.fontSize,s.fontColor,a):i>0&&f==h?s._drawText(o,e,s.fontSize,s.fontColor,"/"+a):s._drawText(o-r.width/2,e,s.fontSize,s.fontColor,a),f=h):s._drawText(s.width-r.width-3*s.dpr,e,s.fontSize,s.fontColor,a)}else f=0}))}if(this.chartType==t.dsxConfig.chartType.timeSharing5){var u=this.width/this.times5.length;this.times5.forEach((function(t,h){i=u*(h+1);var n=t,o=s._getTextSize(s.fontSize,n);s._drawLine(i-s.gridLineWidth/2,s.paddingTop,i-s.gridLineWidth/2,s.paddingTop+s.mainHeight,s.gridLineWidth,s.gridLineColor),s._drawLine(i-s.gridLineWidth/2,s.paddingTop+s.mainHeight+s.paddingMiddle,i-s.gridLineWidth/2,s.height-s.paddingBottom,s.gridLineWidth,s.gridLineColor),i<=o.width&&(i=3*s.dpr+o.width/2),s._drawText(i-o.width/2-u/2,e,s.fontSize,s.fontColor,n)}))}},n.prototype._showMainTips=function(){var i=this;if(null!=this.datas&&!(this.datas.length<=0)){var e=this,s=this.currentData;if(null!=s){var h=3*e.dpr,n=e.paddingTop/2+e.fontSize/2;this.main.forEach((function(o){var a=t.dsxConfig.index[o],r=a.title;if(!(a.chartType.indexOf(e.chartType)<0||a.location.indexOf("main")<0)){var d=e._getTextSize(e.fontSize,r);""!=r&&(e._drawText(h,n,e.fontSize,e.fontColor,r),h+=d.width+5*e.dpr);var l=a.draw;Object.keys(l).forEach((function(t){var a=s.ZHIBIAO[o][t],r=l[t].model;if(a){var c=l[t].color,p=t+":"+("text"==r?a:a.toFixed(2));if(""==c){var g=s.ZHIBIAO[o][t+".value"];c=g>i.lastClose?i.red:g<i.lastClose?i.green:i.fontColor}e._drawText(h,n,e.fontSize,c,p),d=e._getTextSize(e.fontSize,p),h+=d.width+5*e.dpr}}))}}))}}},n.prototype._showSideTips=function(){var i=this;if(null!=this.datas&&!(this.datas.length<=0)){var e=this,s=this.currentData;if(null!=s){var h=0,n=0,o=this.sideHeight,a=this.mainHeight;this.sides.forEach((function(r,d){h=3*e.dpr,n=3*e.dpr+e.fontSize+a+o*d+e.paddingTop+e.paddingMiddle;var l=t.dsxConfig.index[r],c=l.title;if(l.chartType.indexOf(e.chartType)<0){var p=r+"不支持此图型显示",g=e._getTextSize(e.fontSize,p),f=h+(e.width-g.width)/2,u=n+(o/2-e.fontSize);e._drawText(f,u,e.fontSize,e.fontColor,p)}else if(l.location.indexOf("sides")<0){var m=r+"不支持在副图显示",T=e._getTextSize(e.fontSize,m),x=h+(e.width-T.width)/2,y=n+(o/2-e.fontSize);e._drawText(x,y,e.fontSize,e.fontColor,m)}else{var I=e._getTextSize(e.fontSize,c);""!=c&&(e._drawText(h,n,e.fontSize,e.fontColor,c),h+=I.width+5*e.dpr);var S=l.draw;Object.keys(S).forEach((function(o){var a=s.ZHIBIAO[r][o],d=S[o].color,l=S[o].model,c=S[o].hiddenTitle;if(null!=a&&null!=a&&!(e.chartType<=t.dsxConfig.chartType.timeSharing5&&"VOL"==r&&"VOL"!=o)){if("text"!=l&&("string"==typeof a&&(a=parseFloat(a)),a=e._number(a)),""==d){var p=s.ZHIBIAO[r][o+".value"];p>i.lastClose?i.red:p<i.lastClose?i.green:i.fontColor,function(t){throw new TypeError('"color" is read-only')}()}var g=1==c?a:o+":"+a;e._drawText(h,n,e.fontSize,d,g),I=e._getTextSize(e.fontSize,g),h+=I.width+5*e.dpr}}))}}))}}},n.prototype._showMaxMinKlineHighTip=function(){if(!(this.highIndex<0||this.lowIndex<0||this.showDatas.length<=0)){var t=this.showDatas[this.highIndex],i=this.showDatas[this.lowIndex];this._showValueTip(t.HIGH,this.highIndex,3*this.dpr),this._showValueTip(i.LOW,this.lowIndex,-3*this.dpr)}},n.prototype._showValueTip=function(t,i,e){var s=this.mainHeight,h=(i+1)*(this.klineWidth+this.klinePadding)-this.klinePadding-this.klineWidth/2+this.startX,n=(this.maxY-t)/(this.maxY-this.minY)*s-e+this.paddingTop,o=this._getTextSize(this.fontSize,t),a=10*this.dpr;h>this.width/2?(this._drawLine(h-a-this.dpr,n,h-this.dpr,n,this.lineWidth,this.fontColor),this._drawIndex(h-a-this.dpr-1.5*this.dpr,n,0,0,this.fontColor,"cycle",3*this.dpr,0,0),this._drawText(h-a-o.width-7*this.dpr,n+Math.abs(e),this.fontSize,this.fontColor,t)):(this._drawLine(h+this.dpr,n,h+a+this.dpr,n,this.lineWidth,this.fontColor),this._drawIndex(h+this.dpr+a+1.5*this.dpr,n,0,0,this.fontColor,"cycle",3*this.dpr,0,0),this._drawText(h+a+7*this.dpr,n+Math.abs(e),this.fontSize,this.fontColor,t))},n.prototype._showKlineTips=function(){if(this.isShowKlineTipPannel&&this.chartType==t.dsxConfig.chartType.candle){if(!this.currentData)return;var i=this.mainHeight,e=this.currentData.CURRENTINDEX*(this.klineWidth+this.klinePadding),s=i/5,h=this.currentData,n=h.OPEN,o=h.HIGH,a=h.LOW,r=h.CLOSE,d=h.DATE,l=h.TIME?h.TIME:"1500",c=h.VOL,p=h.AMOUNT,g=h.LASTCLOSE,f=r-g,u=g>0?f/g*100:0,m="时间 "+d+" "+l.substr(0,2)+":"+l.substr(2,2),T=this._getTextSize(this.fontSize,m),x=20*this.dpr,y=T.width+10*this.dpr,I=5*this.dpr+9*(this.fontSize+5*this.dpr);if(e=e>this.width/2?x:this.width-y-x,this.width>this.height&&this.width>5*y){var S=this.currentIndex*(this.klineWidth+this.klinePadding)+this.klineWidth/2;e=S+(S>this.width/2?-y-y:y)}this._drawRoundRect(e,s,y,I,3*this.dpr,this.fontBgColor,!1),this._drawRoundRect(e+this.dpr,s+this.dpr,y-2*this.dpr,I-2*this.dpr,3*this.dpr,this.backgroundColor,!0),e+=5*this.dpr,s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"时间",m,0),s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"开",n,g),s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"高",o,g),s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"低",a,g),s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"收",r,g),s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"涨跌额",f.toFixed(this.decimalPoint),-1),s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"涨跌幅",u.toFixed(this.decimalPoint)+"%",-1),s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"成交量",this._number(c/100)+"手",0),s+=this.fontSize+5*this.dpr,this._drawKlineTipFont(e,s,y,"成交额",this._number(p),0)}},n.prototype._drawKlineTipFont=function(t,i,e,s,h,n){var o=this._getTextSize(this.fontSize,h),a=0==n?this.fontColor:h>n?this.red:h==n?this.fontColor:this.green;if(-1==n){var r=parseFloat(h);a=0==r?this.fontColor:r>0?this.red:this.green}this._drawText(t,i,this.fontSize,this.fontColor,s),this._drawText(t+e-o.width-10*this.dpr,i,this.fontSize,a,h)},n.prototype._number=function(t){var i=1e4;return null==t||0==t?"0.00":("string"==typeof t&&(t=parseFloat(t)),t>i*i?t=(t/i/i).toFixed(this.decimalPoint)+"亿":t>i?t=(t/i).toFixed(this.decimalPoint)+"万":t<i&&(t=t.toFixed(this.decimalPoint)),t)},n.prototype.showLoading=function(t){var i=this.mainHeight,e=this._getTextSize(this.fontSize,t),s=this.fontSize,h=e.width,n=(this.width-h)/2,o=(i-s)/2;this._drawRoundRect(n-10*this.dpr,o-10*this.dpr,h+20*this.dpr,s+20*this.dpr,5,this.fontBgColor),this._drawText(n,o+10*this.dpr,this.fontSize,"#ffffff",t)},n.prototype.showDebug=function(t){if(this.debug){this.mainHeight;var i=this._getTextSize(this.fontSize,t),e=Math.max(this.fontSize,35*this.dpr),s=this.width,h=0,n=0;this._drawRoundRect(h,n,s,e,5,"rgba(255,165,0,1)"),h+=i.width,n=n+e/2+this.fontSize/2-3,this._drawText(20,n,this.fontSize,this.fontColor,t),console.log(t)}},n.prototype._mouseEvent=s.mouseEvent,e.g.dsxKline=n}()}();